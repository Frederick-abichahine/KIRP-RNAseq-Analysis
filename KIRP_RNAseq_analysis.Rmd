---
title: "Kidney Renal Papillary Cell Carcinoma"
subtitle: "Bioinformatics Resources Project"
author: 
  - "Frederick Abi Chahine"
  - "Hala Alshaar"
  - "Anastasia Bertova"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: false
      smooth_scroll: true
    code_folding: show
    fig_caption: true
    df_print: paged
    theme: flatly
    highlight: zenburn
    self_contained: true
params:
  show_code: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
  
## Introduction  
  
**Kidney Renal Papillary Cell Carcinoma** (KIRP) is a distinct subtype of renal cell carcinoma that represents approximately *10â€“15%* of all kidney cancers. It is characterized by unique histological features and molecular alterations that differ from the more common clear cell renal carcinoma. KIRP is further classified into two main subtypes, **type 1 and type 2**, which vary in their cellular characteristics and clinical behavior (Delahunt & Eble, 1997). Despite advances in understanding some genetic mutations involved in KIRP, such as alterations in the *MET gene and fumarate hydratase (FH)*, much remains unknown about the full spectrum of molecular changes driving this disease (TCGA Research Network, 2016; Menko et al., 2014).

**RNA sequencing** (RNA-seq) is a powerful technology that enables the comprehensive analysis of gene expression across the entire transcriptome. By examining RNA-Seq data from *50 tumor samples and 50 matched normal kidney tissue controls*, we can identify **differentially expressed genes (DEGs) and disrupted molecular pathways specific to KIRP**. This analysis will deepen our understanding of the biological mechanisms underlying tumor initiation and progression. Additionally, it may reveal **novel biomarkers** for diagnosis and **potential therapeutic targets**, ultimately contributing to improved clinical management of KIRP patients (Choueiri et al., 2015; Truong & Shen, 2011).
  
## Project Pipeline  
  
This project focuses on the analysis of **RNA-seq** count data derived from KIRP samples obtained from **The Cancer Genome Atlas** (TCGA). The goal is to explore the molecular differences between **tumor and normal tissues** through a comprehensive bioinformatics pipeline. Key steps include **data preprocessing, filtering for protein-coding genes** using the *biomaRt package*, and **identifying DEGs** via the *edgeR package*. **Visualization** techniques such as *volcano plots and heatmaps* are used to interpret the differential expression results. **Gene set enrichment analysis** (GSEA) is performed using the *fgsea package* to uncover significantly altered pathways in cancer. In addition, we **investigate transcription factors** (TFs) with enriched binding motifs in the promoters of regulated genes and **examine protein-protein interaction** (PPI) networks using *STRING and igraph*. This multi-layered approach provides insights into the transcriptional landscape of KIRP and highlights potential biomarkers or therapeutic targets for further research.

## Loading Dependencies  
  
```{r libraries, message=FALSE, warning=FALSE}
library(biomaRt) # For querying Ensembl databases to retrieve gene information
library(edgeR) # For differential expression analysis of RNA-seq data
library(ggplot2) # For data visualization
library(ComplexHeatmap) # For creating customizable heatmaps
library(circlize) # For being able to use color functions in ComplexHeatmap
library(RColorBrewer) # For color palettes
library(fgsea) # For performing gene set enrichment analysis
library(msigdbr) # For loading MSigDB gene sets
library(MotifDb) # For working with transcription factor binding motifs
library(PWMEnrich) # For motif enrichment analysis
library(PWMEnrich.Hsapiens.background) # For human background motif data
library(Biostrings) # For handling biological sequences
library(GenomicRanges) # For working with genomic ranges and annotations
library(TxDb.Hsapiens.UCSC.hg38.knownGene) # For gene annotations and genomic features (hg38)
library(TxDb.Hsapiens.UCSC.hg19.knownGene) # For gene annotations and genomic features (hg19)
library(BSgenome.Hsapiens.UCSC.hg38) # For accessing the human genome sequence (hg38)
library(dplyr) # For data manipulation and transformation
library(STRINGdb) # For accessing the STRING database for protein-protein interactions
library(igraph) # For creating and analyzing networks
library(ggraph) # For visualizing networks with ggplot2 syntax
library(tidygraph) # For tidy data manipulation of graph objects
```


## 1. Loading, Exploring & Preprocessing the Data  

```{r}
# Setting dynamic working directory
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

# Reading the KIRP data
load("./BR_project_data_kidney_renal_papillary_cell_carcinoma.RData")

# Exploring the data
ls()
head(raw_counts_df[, 1:5])
head(c_anno_df)
head(r_anno_df)
summary(raw_counts_df)
summary(c_anno_df)
summary(r_anno_df)
dim(raw_counts_df)
dim(c_anno_df)
dim(r_anno_df)

# Preprocessing required fields
c_anno_df$condition <- factor(c_anno_df$condition)
summary(c_anno_df$condition)
```
  
The RData file contains **three data frames**:  
  
| Data Frame       | Description                                      | Dimensions     |  
|------------------|--------------------------------------------------|----------------|  
| `raw_counts_df`  | Raw RNA-seq counts                               | 62940 x 100    |  
| `c_anno_df`      | Sample names and conditions                      | 100 x 2        |  
| `r_anno_df`      | Ensembl gene IDs, gene lengths, and gene symbols | 62940 x 3      |  
  
Additionally, the condition column in `c_anno_df` was converted to a factor to facilitate downstream analysis.
  
## 2. Extracting Protein-Coding Genes  

```{r}
# Querying the Ensembl database for homo sapiens gene information
ensembl <- useEnsembl(biomart = "genes", dataset = "hsapiens_gene_ensembl")

# Getting gene information for the Ensembl IDs in r_anno_df
gene_info <- getBM(attributes = c("ensembl_gene_id", "gene_biotype"),
                   filters = "ensembl_gene_id",
                   values = r_anno_df$ensembl_gene_id,
                   mart = ensembl)

# Extracting protein-coding genes from the gene_info data frame
protein_coding_genes <- gene_info[gene_info$gene_biotype == "protein_coding", ]
cat("> Number of protein-coding genes:", nrow(protein_coding_genes), "\n")

# Updating data frames to include only protein-coding genes
raw_counts_df <- raw_counts_df[rownames(raw_counts_df) %in% protein_coding_genes$ensembl_gene_id, ]
r_anno_df <- r_anno_df[r_anno_df$ensembl_gene_id %in% protein_coding_genes$ensembl_gene_id, ]
```
  
From the annotated gene list, we **filtered for protein-coding genes** using the *Ensembl BioMart database*. This resulted in a subset of *22152 protein-coding genes* out of the original *62940 input genes*. The raw count matrix and annotation were aligned accordingly to ensure consistency for downstream expression analysis.  
  
The updated dimensions of the data frames are as follows:  

| Data Frame       | Dimensions Before | Dimensions After  |
|------------------|-------------------|-------------------|
| `raw_counts_df`  | 62940 x 100       | 22152 x 100       |
| `r_anno_df`      | 62940 x 3         | 22152 x 3         |  
